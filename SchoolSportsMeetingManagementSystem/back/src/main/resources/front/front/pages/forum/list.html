<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>论坛</title>
    <link rel="stylesheet" href="../../layui/css/layui.css">
    <script type="text/javascript" src="../../xznstatic/js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="../../xznstatic/js/jquery.SuperSlide.2.1.1.js"></script>
    <!-- 样式 -->
    <link rel="stylesheet" href="../../css/style.css" />
    <!-- 主题（主要颜色设置） -->
    <link rel="stylesheet" href="../../css/theme.css" />
    <!-- 通用的css -->
    <link rel="stylesheet" href="../../css/common.css" />
</head>
<style>
    /* 基础样式优化 */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    body {
        background-color: #f5f7fa;
        padding: 20px 0;
    }
    #app {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* 轮播样式优化 */
    #swiper {
        overflow: hidden;
        border-radius: 8px;
        margin: 20px 0;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    #swiper .layui-carousel-ind li {
        width: 20px;
        height: 6px;
        border-radius: 3px;
        background-color: rgba(255,255,255,0.6);
        margin: 0 4px;
        transition: all 0.3s ease;
        box-shadow: none;
    }
    #swiper .layui-carousel-ind li.layui-this {
        width: 30px;
        height: 6px;
        background-color: #fff;
    }

    /* 标题区域优化 */
    .index-title {
        text-align: center;
        width: 100%;
        padding: 20px 30px;
        margin: 0 auto 30px;
        border-radius: 8px;

        color: #fff;
        box-shadow: 0 4px 12px rgba(211, 84, 0, 0.2);
        position: relative;
        overflow: hidden;
    }
    .index-title::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }
    .index-title span:first-child {
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 8px;
        opacity: 0.9;
    }
    .index-title span:last-child {
        font-size: 28px;
        font-weight: 600;
        letter-spacing: 1px;
    }

    /* 按钮容器优化 */
    .forum-container {
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        padding: 25px;
    }
    .forum-container .btn-container {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding: 15px 0;
        margin-bottom: 20px;
        border-bottom: 1px solid #f0f0f0;
    }
    .forum-container .btn-container button {
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    .forum-container .btn-container button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(211, 84, 0, 0.2);
    }
    .forum-container .btn-container button i {
        margin-right: 6px;
    }

    /* 论坛列表优化 */
    .forum-list {
        margin-bottom: 30px;
    }
    .forum-item {
        padding: 18px 20px;
        border-radius: 8px;
        margin-bottom: 12px;
        background-color: #fff;
        border: 1px solid #f0f0f0;
        transition: all 0.3s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .forum-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        border-color: #e8e8e8;
    }
    .forum-item > div:first-child {
        flex: 1;
        padding-right: 20px;
    }
    .h2 {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .h2 span:first-child {
        font-size: 18px;
        font-weight: 500;
        color: #333;
        transition: color 0.3s ease;
        line-height: 1.5;
    }
    .forum-item:hover .h2 span:first-child {
        color: #d35400;
    }
    .h2 span:last-child {
        font-size: 14px;
        color: #888;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    .h2 span:last-child::before {
        content: '•';
        font-size: 16px;
        color: #ddd;
    }
    .create-time {
        font-size: 14px;
        color: #999;
        white-space: nowrap;
        padding: 0 10px;
    }
    .forum-item > span {
        color: #ff4d4f;
        cursor: pointer;
        padding: 5px 10px;
        border-radius: 4px;
        transition: all 0.2s ease;
        opacity: 0.7;
    }
    .forum-item > span:hover {
        opacity: 1;
        background-color: #fff5f5;
    }

    /* 分页样式优化 */
    .pager {
        text-align: center;
        padding: 15px 0;
    }
    .layui-laypage {
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }
    .layui-laypage .layui-laypage-count {
        padding: 0 15px;
        color: #666;
    }
    .layui-laypage .layui-laypage-skip {
        padding-left: 15px;
        color: #666;
    }
    .layui-laypage a, .layui-laypage span {
        border-radius: 4px;
        transition: all 0.2s ease;
    }
    .layui-laypage a:hover {
        color: #d35400;
        border-color: #d35400;
    }
    .layui-laypage .layui-laypage-curr .layui-laypage-em {
        background-color: #d35400;
        border-radius: 4px;
    }

    /* 对话框样式优化 */
    .el-dialog__title {
        color: #333;
        font-size: 18px;
        font-weight: 500;
    }
    .el-form-item__label {
        color: #666;
        font-weight: 400;
    }
    .el-input__inner, .el-textarea__inner {
        border-radius: 6px;
        border-color: #e0e0e0;
        transition: all 0.3s ease;
    }
    .el-input__inner:focus, .el-textarea__inner:focus {
        border-color: #d35400;
        box-shadow: 0 0 0 2px rgba(211, 84, 0, 0.1);
    }
    .el-button--primary {
        background-color: #d35400;
        border-color: #d35400;
    }
    .el-button--primary:hover {
        background-color: #c0392b;
        border-color: #c0392b;
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
        .index-title span:last-child {
            font-size: 22px;
        }
        .forum-container {
            padding: 15px;
        }
        .forum-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
            padding: 15px;
        }
        .h2 span:first-child {
            font-size: 16px;
        }
        .create-time {
            align-self: flex-end;
            margin-top: 5px;
        }
        .forum-item > span {
            align-self: flex-end;
            margin-top: -25px;
        }
    }
</style>
<body>

<div id="app">
    <div class="index-title sub_backgroundColor">
        <span>FORUM / INFORMATION</span>
        <span>论坛</span>
    </div>
    <div class="forum-container">
        <div class="btn-container main_backgroundColor">
            <button class="layui-btn layui-btn-lg btn-theme main_backgroundColor"
                    @click="forumTop" type="button">
                <i class="layui-icon">&#xe654;</i> 发布帖子
            </button>
        </div>

        <div class="forum-list">
            <div v-for="(item,index) in dataList" v-bind:key="index" class="forum-item">
                <div @click="jump('../forum/detail.html?id='+item.id);" style="width: 100%;">
                    <h2 v-if="item.yonghuId" class="h2">
                        <span>{{(item.forumName).length> 30?item.forumName.substring(0, 30)+'...':item.forumName}}</span>
                        <span>发布人：{{item.yonghuName}} （用户）</span>
                    </h2>
                    <h2 v-if="item.usersId" class="h2">
                        <span>{{(item.forumName).length> 30?item.forumName.substring(0, 30)+'...':item.forumName}}</span>
                        <span>发布人：管理员 （管理员）</span>
                    </h2>
                </div>
                <div class="create-time">{{item.insertTime}}</div>
                <span @click="deleteData(item)" v-if="item.yonghuId != null && item.yonghuId == user.id">
                    <i class="layui-icon">&#xe640;</i>
                </span>
            </div>
        </div>

        <div class="pager" id="pager"></div>
    </div>

    <!-- 发布帖子对话框 -->
    <el-dialog title="发布帖子" :visible.sync="dialogFormVisible" class="demo-ruleForm" width="600px">
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm">
            <el-form-item label="标题" :label-width="formLabelWidth" prop="forumName">
                <el-input v-model="ruleForm.forumName" autocomplete="off" placeholder="请输入帖子标题"></el-input>
            </el-form-item>
            <el-form-item label="帖子内容" :label-width="formLabelWidth" prop="forumContent">
                <el-input type="textarea" v-model="ruleForm.forumContent" rows="6" placeholder="请输入帖子内容"></el-input>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogFormVisible = false">取 消</el-button>
            <el-button type="primary" @click="addForum('ruleForm')">确 定</el-button>
        </div>
    </el-dialog>
</div>

<!-- 引入相关脚本 -->
<script src="../../layui/layui.js"></script>
<script src="../../js/vue.js"></script>
<script src="../../xznstatic/js/element.min.js"></script>
<link rel="stylesheet" href="../../xznstatic/css/element.min.css">
<script src="../../js/config.js"></script>
<script src="../../modules/config.js"></script>
<script src="../../js/utils.js"></script>

<script>
    var vue = new Vue({
        el: '#app',
        data: {
            user: {},
            forumTypes: -1,
            dataList: [],
            forumTypesList: [],
            ruleForm: {
                forumStateTypes: 1,
                forumName: '',
                forumContent: '',
            },
            rules: {
                forumName: [
                    { required: true, message: '请输入标题', trigger: 'blur' },
                ],
                forumContent: [
                    { required: true, message: '请输入帖子内容', trigger: 'blur' }
                ],
            },
            dialogFormVisible: false,
            formLabelWidth: '120px'
        },
        filters: {
            newsDesc: function(val) {
                if (val) {
                    return val.length > 200
                        ? val.substring(0, 200).replace(/<[^>]*>/g).replace(/undefined/g, '')
                        : val.replace(/<[^>]*>/g).replace(/undefined/g, '');
                }
                return '';
            }
        },
        methods: {
            deleteData(data){
                var mymessage = confirm("确定要删除这条数据吗？");
                if(!mymessage) return false;

                layui.http.requestJson(`forum/delete`, 'post', [data.id], (res) => {
                    if(res.code === 0){
                        layer.msg('删除成功', { time: 2000, icon: 6 });
                        window.location.reload();
                    }else{
                        layer.msg(res.msg, { time: 2000, icon: 2 });
                    }
                });
            },
            forumTop(){
                this.jump("./add.html")
            },
            jump(url) {
                jump(url)
            },
            addForum() {
                let _this = this;
                this.$refs["ruleForm"].validate((valid) => {
                    if (valid) {
                        layui.http.requestJson('forum/save', 'post',_this.ruleForm, function (res) {
                            layer.msg('发布成功', {
                                time: 1000,
                                icon: 6
                            }, function () {
                                _this.pageList();
                                _this.dialogFormVisible = false
                            });
                        });
                    }
                });
            },
            pageList(category) {
                let _this = this;
                let param = { page: 1, limit: 10 }
                if (category != null && category != -1) {
                    param['forumTypes'] = category;
                }
                layui.http.request('forum/list?forumStateTypes=1', 'get', param, function (res) {
                    _this.dataList = res.data.list;
                    // 分页渲染
                    layui.laypage.render({
                        elem: 'pager',
                        count: res.data.total,
                        limit: 10,
                        groups: 3,
                        layout: ["prev", "page", "next"],
                        jump: function(obj, first) {
                            if (!first) {
                                layui.http.request('forum/list?forumStateTypes=1', 'get', {
                                    page: obj.curr,
                                    limit: obj.limit
                                }, function(res) {
                                    _this.dataList = res.data.list;
                                });
                            }
                        }
                    });
                });
            },
        }
    });

    layui.use(['layer', 'element', 'carousel', 'laypage', 'http', 'jquery'], function() {
        var layer = layui.layer;
        var element = layui.element;
        var carousel = layui.carousel;
        var laypage = layui.laypage;
        var http = layui.http;
        var jquery = layui.jquery;

        localStorage.setItem("goUtl", "./pages/forum/list.html");

        let table = localStorage.getItem("userTable");
        if(table){
            http.request(table+"/session", 'get', {}, function (data) {
                vue.user = data.data;
            });
        }

        vue.pageList();
    });
</script>
</body>
</html>